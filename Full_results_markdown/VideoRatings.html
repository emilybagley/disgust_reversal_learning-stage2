<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Video ratings</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="VideoRatings_files/libs/clipboard/clipboard.min.js"></script>
<script src="VideoRatings_files/libs/quarto-html/quarto.js"></script>
<script src="VideoRatings_files/libs/quarto-html/popper.min.js"></script>
<script src="VideoRatings_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="VideoRatings_files/libs/quarto-html/anchor.min.js"></script>
<link href="VideoRatings_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="VideoRatings_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="VideoRatings_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="VideoRatings_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="VideoRatings_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Video ratings</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>
This file contains all the analyses for the video ratings task.
</p>
<p>
During this task, participants rated the valence, arousal, fear and disgust of 10 videos from Cowen and Keltner (2017). This was done <b>both before and after</b> the reversal learning task.
</p>
<p>
For each participant, the ‘best’ pair of fear and disgust videos (see paper for equation used to determine the ‘best’ pair) was selected prior to the reversal learning task. This pair were then used as punishments in the reversal learning task for the fear and disgust feedback-type blocks.
</p>
<p>
Analyses here <b>only look at the individually selected video pair</b> for each participant.
</p>
<br>
<p>
Additionally, after the points block (which doesn’t use the Cowen and Keltner videos), each participant was asked to rate the valence, arousal, fear and disgust they felt when they lost points.
</p>
<p>
Analysis of these responses is also detailed here.
</p>
<br>
<p>
This notebook contains
</p>
<li>
Analysis of ratings of the selected Cowen and Keltner videos to identify any differences in valence, arousal and habituation between the two stimulus types (models A and B).
</li><li>
Analysis of ratings of the selected Cowen and Keltner videos to validate that fear and disgust was sucessfully induced (models C and D)
</li><li>
Analysis of the points ratings (in comparison to timepoint 1 of the selected videos) to assess how the points feedback differed from the fear and disgust feedback
</li><li>
Visualisation of these results
<p>
</p>
<br>
<h3 class="anchored">
Step 1: load in packages and data
</h3>
<div id="python-packages" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jsonlines</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> std, mean, sqrt</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>chosen_stim_df <span class="op">=</span> pd.read_csv(<span class="st">"U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/csvs/chosen_stim_excluded.csv"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>chosen_stim_df.drop(<span class="st">'Unnamed: 0'</span>, axis<span class="op">=</span><span class="st">"columns"</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<h3 class="anchored">
Step 2: create long-form data frame
</h3>
<div id="long-form-df" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>long_chosen_stim_df<span class="op">=</span>pd.DataFrame()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> chosen_stim_df.index:</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span>chosen_stim_df.loc[i]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#timepoint=['unpleasan']</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    timepoint_1<span class="op">=</span>pd.DataFrame({</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'participant_no'</span>: [row.participant_no],</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: [row.prolific_age],</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sex'</span>: [row. prolific_sex],</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vid'</span>: [<span class="bu">str</span>(row[<span class="st">'Vid'</span>])],</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'trial_type'</span>: [row.trial_type],</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Valence'</span>: [row.unpleasant_1],</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Arousal'</span>: [row.arousing_1],</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Fear'</span>: [row.frightening_1],</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Disgust'</span>: [row.disgusting_1],</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Timepoint'</span>: <span class="fl">1.0</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    timepoint_2<span class="op">=</span>pd.DataFrame({</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'participant_no'</span>: [row.participant_no],</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'age'</span>: [row.prolific_age],</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>: [row. prolific_sex],</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Vid'</span>: [<span class="bu">str</span>(row[<span class="st">'Vid'</span>])],</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'trial_type'</span>: [row.trial_type],</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Valence'</span>: [row.unpleasant_2],</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Arousal'</span>: [row.arousing_2],</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fear'</span>: [row.frightening_2],</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Disgust'</span>: [row.disgusting_2],</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Timepoint'</span>: <span class="fl">2.0</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    long_chosen_stim_df_row<span class="op">=</span>pd.concat([timepoint_1, timepoint_2])</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    long_chosen_stim_df<span class="op">=</span>pd.concat([long_chosen_stim_df_row, long_chosen_stim_df])</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    long_chosen_stim_df<span class="op">=</span>long_chosen_stim_df[long_chosen_stim_df.trial_type<span class="op">!=</span><span class="st">"points"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<h3 class="anchored">
Step 3: Assess the valence, arousal, disgust and fear ratings of the fear and disgust videos used in the reversal learning task
</h3>
<p>
Do this using 4 mixed effects models - testing effect of timepoint and stimulus type on ratings
</p>
<p>
List of models to run:
</p></li><li>
Model A- ’Valence ~ trial_type*Timepoint’
</li><li>
Model B- ’Arousal ~ trial_type*Timepoint’
</li><li>
Model C- ’Disgust ~ trial_type*Timepoint’
</li><li>
Model D- ’Fear ~ trial_type*Timepoint’
<p>
</p>
<br> <br>
<p>
Before running the models, we can visualise this data:
</p>
<div id="30d5f5bc" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">4</span>, sharex<span class="op">=</span><span class="st">'col'</span>, sharey<span class="op">=</span><span class="st">'col'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#title="Ratings of videos used in reversal learning task"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.suptitle(title, fontsize=30)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.suptitle(title)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.set_size_inches(10, 5)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">'fear'</span>: <span class="st">'blue'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'disgust'</span>: <span class="st">'green'</span>}</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=long_chosen_stim_df, ax=axes[0,0], x='Timepoint', y='Valence', hue='trial_type', dodge=True, palette=palette)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">0</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Valence'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, fill<span class="op">=</span><span class="va">True</span>, palette<span class="op">=</span>palette, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"Valence rating"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>sns.pointplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">0</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Valence'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, dodge<span class="op">=</span><span class="va">True</span>, palette<span class="op">=</span>palette)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].xaxis.get_label().set_fontsize(<span class="dv">15</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=long_chosen_stim_df, ax=axes[0,1], x='Timepoint', y='Arousal', hue='trial_type', dodge=True, palette=palette)</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">1</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Arousal'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, fill<span class="op">=</span><span class="va">True</span>, palette<span class="op">=</span>palette, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">"Arousal rating"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>sns.pointplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Arousal'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, dodge<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>palette)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].xaxis.get_label().set_fontsize(<span class="dv">15</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=long_chosen_stim_df, ax=axes[0,2], x='Timepoint', y='Fear', hue='trial_type', dodge=True, palette=palette)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">2</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Fear'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, fill<span class="op">=</span><span class="va">True</span>, palette<span class="op">=</span>palette, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">2</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">2</span>].set_title(<span class="st">"Fear rating"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>sns.pointplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">2</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Fear'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, dodge<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>palette)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">2</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">2</span>].xaxis.get_label().set_fontsize(<span class="dv">15</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=long_chosen_stim_df, ax=axes[0,3], x='Timepoint', y='Disgust', hue='trial_type', dodge=True, palette=palette)</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">3</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Disgust'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, fill<span class="op">=</span><span class="va">True</span>, palette<span class="op">=</span>palette, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">3</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">3</span>].set_title(<span class="st">"Disgust rating"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>sns.pointplot(data<span class="op">=</span>long_chosen_stim_df, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">3</span>], x<span class="op">=</span><span class="st">'Timepoint'</span>, y<span class="op">=</span><span class="st">'Disgust'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, dodge<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span>palette)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">3</span>].get_legend().set_visible(<span class="va">False</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">3</span>].xaxis.get_label().set_fontsize(<span class="dv">15</span>)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>plt.figlegend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>),  handles<span class="op">=</span>[mpatches.Patch(facecolor<span class="op">=</span><span class="st">'blue'</span>), mpatches.Patch(facecolor<span class="op">=</span><span class="st">'green'</span>)], labels<span class="op">=</span>[<span class="st">'Fear stimulus'</span>, <span class="st">'Disgust stimulus'</span>])</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">#handles=[mpatches.Patch(facecolor='blue'), mpatches.Patch(facecolor='green')], labels=['Fear stimulus', 'Disgust stimulus'], prop={'size':15})</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="VideoRatings_files/figure-html/cell-4-output-1.png" width="684" height="540" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<br> <br>
<p>
<b>MODEL A: VALENCE ~ TRIAL_TYPE*TIMEPOINT</b>
</p>
<p>
In this case, the basic model with a by-participant random slope, but no random intercepts or additional covariates produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: disgust videos had a more negative valence than fear (this was <b>counter to prediction</b>)
</li><li>
It also revealed a trial-type*timepoint interaction: valence ratings for disgust didn’t change as much over time relative to fear (i.e., disgust is resistant to habituation).
<p>
</p>
<div id="model-a" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>long_chosen_stim_df.reset_index()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data.replace([<span class="st">'disgust'</span>, <span class="st">'fear'</span>], [<span class="fl">1.0</span>,<span class="fl">2.0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'Valence ~ trial_type*Timepoint'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>, re_formula<span class="op">=</span><span class="st">'~trial_type'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Mixed Linear Model Regression Results
=================================================================
Model:               MixedLM    Dependent Variable:    Valence   
No. Observations:    1360       Method:                ML        
No. Groups:          340        Scale:                 1.8645    
Min. group size:     4          Log-Likelihood:        -2696.3107
Max. group size:     4          Converged:             Yes       
Mean group size:     4.0                                         
-----------------------------------------------------------------
                       Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
-----------------------------------------------------------------
Intercept               6.318    0.381 16.590 0.000  5.571  7.064
trial_type             -0.488    0.240 -2.033 0.042 -0.959 -0.018
Timepoint               0.224    0.234  0.955 0.340 -0.235  0.683
trial_type:Timepoint   -0.329    0.148 -2.224 0.026 -0.620 -0.039
Group Var               2.692    0.506                           
Group x trial_type Cov -0.975    0.279                           
trial_type Var          0.959    0.194                           
=================================================================
</code></pre>
</div>
</div>
<br>
<p>
<b>MODEL B: AROUSAL ~ TRIAL_TYPE*TIMEPOINT</b>
</p>
<p>
In this case, the basic model with no by-participant random slope, no random intercepts and no additional covariates produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: fear videos had were more arousing than disgust (this was <b>counter to prediction</b>)
</li><li>
There was no trial-type*timepoint interaction (no difference in habituation in the arousal measure)
<p>
</p>
<div id="model-b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'Arousal ~ trial_type*Timepoint'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
===============================================================
Model:               MixedLM   Dependent Variable:   Arousal   
No. Observations:    1360      Method:               ML        
No. Groups:          340       Scale:                1.5506    
Min. group size:     4         Log-Likelihood:       -2504.1712
Max. group size:     4         Converged:            Yes       
Mean group size:     4.0                                       
---------------------------------------------------------------
                     Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
---------------------------------------------------------------
Intercept             4.568    0.344 13.260 0.000  3.892  5.243
trial_type            0.594    0.214  2.782 0.005  0.176  1.013
Timepoint            -0.165    0.214 -0.771 0.441 -0.583  0.254
trial_type:Timepoint -0.215    0.135 -1.590 0.112 -0.479  0.050
Group Var             1.580    0.140                           
===============================================================
</code></pre>
</div>
</div>
<br>
<p>
<b>MODEL C: DISGUST ~ TRIAL_TYPE*TIMEPOINT</b>
</p>
<p>
In this case, the model with a by-participant random slope, but no random intercepts and no additional covariates produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: disgust videos had were more disgusting than fear (this was <b>as predicted</b>)
</li><li>
There was an effect of timepoint (all stimuli got less disgusting over time)
</li><li>
There was a trial-type*timepoint interaction (the disgust ratings for fear and disgust videos changed differentially over time)
<p>
</p>
<div id="model-c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'Disgust ~ trial_type*Timepoint'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>, re_formula<span class="op">=</span><span class="st">'~trial_type'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Mixed Linear Model Regression Results
==================================================================
Model:                MixedLM    Dependent Variable:    Disgust   
No. Observations:     1360       Method:                ML        
No. Groups:           340        Scale:                 1.3046    
Min. group size:      4          Log-Likelihood:        -2554.2318
Max. group size:      4          Converged:             Yes       
Mean group size:      4.0                                         
------------------------------------------------------------------
                       Coef.  Std.Err.    z    P&gt;|z| [0.025 0.975]
------------------------------------------------------------------
Intercept              12.262    0.343  35.743 0.000 11.589 12.934
trial_type             -5.762    0.214 -26.953 0.000 -6.181 -5.343
Timepoint              -0.888    0.196  -4.535 0.000 -1.272 -0.504
trial_type:Timepoint    0.582    0.124   4.701 0.000  0.340  0.825
Group Var               7.398    0.877                            
Group x trial_type Cov -3.932    0.498                            
trial_type Var          2.492    0.312                            
==================================================================
</code></pre>
</div>
</div>
<br>
<p>
<b>MODEL D: FEAR ~ TRIAL_TYPE*TIMEPOINT</b>
</p>
<p>
In this case, the model with a by-participant random slope, but no random intercepts and no additional covariates produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: disgust videos had were more disgusting than fear (this was <b>as predicted</b>)
</li><li>
There was an effect of timepoint (all stimuli got less disgusting over time)
</li><li>
There was a trial-type*timepoint interaction (the disgust ratings for fear and disgust videos changed differentially over time)
<p>
</p>
<div id="model-d" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'Fear ~ trial_type*Timepoint'</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>, re_formula<span class="op">=</span><span class="st">'~trial_type'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Mixed Linear Model Regression Results
==================================================================
Model:                MixedLM    Dependent Variable:    Fear      
No. Observations:     1360       Method:                ML        
No. Groups:           340        Scale:                 1.4539    
Min. group size:      4          Log-Likelihood:        -2719.9407
Max. group size:      4          Converged:             Yes       
Mean group size:      4.0                                         
------------------------------------------------------------------
                       Coef.  Std.Err.    z    P&gt;|z| [0.025 0.975]
------------------------------------------------------------------
Intercept              -4.576    0.366 -12.511 0.000 -5.293 -3.860
trial_type              5.391    0.228  23.613 0.000  4.944  5.839
Timepoint               1.671    0.207   8.079 0.000  1.265  2.076
trial_type:Timepoint   -1.124    0.131  -8.591 0.000 -1.380 -0.867
Group Var               9.150    0.996                            
Group x trial_type Cov -4.671    0.557                            
trial_type Var          3.185    0.361                            
==================================================================
</code></pre>
</div>
</div>
<h3 class="anchored">
Step 4: check how points-based feedback differed from disgust and fear-based feedback
</h3>
<p>
Doing this using 4 mixed effects models - testing the effect of stimulus type on ratings
</p>
<p>
List of models to run:
</p></li><li>
Model A- ‘Valence ~ trial_type’
</li><li>
Model B- ‘Arousal ~ trial_type’
</li><li>
Model C- ‘Disgust ~ trial_type’
</li><li>
Model D- ‘Fear ~ trial_type’
<p>
</p>
<p>
NB there is only timepoint 1 of fear and disgust ratings are included in this model (as points rating only has one timepoint).
</p>
<br> <br>
<p>
Before running the models, we can visualise this data:
</p>
<div id="7ac328ed" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>chosen_stim_df[[<span class="st">'participant_no'</span>, <span class="st">'trial_type'</span>, <span class="st">'unpleasant_1'</span>, <span class="st">'arousing_1'</span>, <span class="st">'disgusting_1'</span>, <span class="st">'frightening_1'</span>]].sort_values(<span class="st">'trial_type'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>title<span class="op">=</span><span class="st">"Initial ratings of videos fear, disgust and points videos"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.suptitle(title, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>order<span class="op">=</span>[<span class="st">'fear'</span>, <span class="st">'disgust'</span>, <span class="st">'points'</span>]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">'fear'</span>: <span class="st">'blue'</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'disgust'</span>: <span class="st">'green'</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'points'</span>: <span class="st">'purple'</span>}</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>data, ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">0</span>],   x<span class="op">=</span><span class="st">'trial_type'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, y<span class="op">=</span><span class="st">'unpleasant_1'</span>, palette<span class="op">=</span>palette, legend<span class="op">=</span><span class="va">False</span>, fill<span class="op">=</span><span class="va">True</span>, linewidth<span class="op">=</span><span class="dv">1</span>, hue_order<span class="op">=</span>order)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=data, ax=axes[0,0],  x='trial_type', hue='trial_type', y='unpleasant_1', palette=palette, legend=False, dodge=False, hue_order=order)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_xlabel(<span class="st">''</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Valence'</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>data, ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">1</span>], x<span class="op">=</span><span class="st">'trial_type'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, y<span class="op">=</span><span class="st">'arousing_1'</span>, palette<span class="op">=</span>palette, legend<span class="op">=</span><span class="va">False</span>, fill<span class="op">=</span><span class="va">True</span>, linewidth<span class="op">=</span><span class="dv">1</span>, hue_order<span class="op">=</span>order)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=data, ax=axes[0,1], x='trial_type', hue='trial_type', y='arousing_1', palette=palette, legend=False, dodge=False, hue_order=order)</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">''</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'Arousal'</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>data, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">0</span>], x<span class="op">=</span><span class="st">'trial_type'</span>, hue<span class="op">=</span><span class="st">'trial_type'</span>, y<span class="op">=</span><span class="st">'disgusting_1'</span>, palette<span class="op">=</span>palette, legend<span class="op">=</span><span class="va">False</span>, fill<span class="op">=</span><span class="va">True</span>, linewidth<span class="op">=</span><span class="dv">1</span>, hue_order<span class="op">=</span>order)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=data, ax=axes[1,0], x='trial_type', hue='trial_type', y='disgusting_1', palette=palette, legend=False, dodge=False, hue_order=order)</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">''</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Disgust'</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>data, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>], x<span class="op">=</span><span class="st">'trial_type'</span>,  hue<span class="op">=</span><span class="st">'trial_type'</span>, y<span class="op">=</span><span class="st">'frightening_1'</span>, palette<span class="op">=</span>palette, legend<span class="op">=</span><span class="va">False</span>, fill<span class="op">=</span><span class="va">True</span>, linewidth<span class="op">=</span><span class="dv">1</span>, hue_order<span class="op">=</span>order)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.stripplot(data=data, ax=axes[1,1], x='trial_type',  hue='trial_type',  y='frightening_1', palette=palette, legend=False, dodge=False, hue_order=order)</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">''</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'Fear'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Text(332.0310606060606, 0.5, 'Fear')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="VideoRatings_files/figure-html/cell-9-output-2.png" width="598" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<br> <br>
<p>
<b>MODEL E: VALENCE ~ TRIAL_TYPE</b>
</p>
<p>
In this case, the basic model with no by-participant random slope, no random intercepts but with sex added as a covariate produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: disgust videos had a more negative valence than points (<b>as predicted</b>)
</li><li>
But there was <b>no predicted difference</b> in valence between points and fear
</li><li>
There was also a significant negative effect of age
<p>
</p>
<div id="model-e" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>chosen_stim_df[[<span class="st">'participant_no'</span>, <span class="st">'trial_type'</span>, <span class="st">'unpleasant_1'</span>, <span class="st">'arousing_1'</span>, <span class="st">'disgusting_1'</span>, <span class="st">'frightening_1'</span>, <span class="st">'Vid'</span>, <span class="st">'prolific_age'</span>, <span class="st">'prolific_sex'</span>]]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>data.replace([<span class="st">'points'</span>], [<span class="st">'apoints'</span>]) <span class="co">##makes comparison condition points</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'unpleasant_1~trial_type+prolific_sex'</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
================================================================
Model:              MixedLM   Dependent Variable:   unpleasant_1
No. Observations:   938       Method:               ML          
No. Groups:         340       Scale:                2.4872      
Min. group size:    2         Log-Likelihood:       -1898.9695  
Max. group size:    3         Converged:            Yes         
Mean group size:    2.8                                         
----------------------------------------------------------------
                      Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
----------------------------------------------------------------
Intercept              4.907    0.139 35.312 0.000  4.634  5.179
trial_type[T.disgust]  1.025    0.132  7.742 0.000  0.765  1.284
trial_type[T.fear]     0.207    0.132  1.565 0.118 -0.052  0.467
prolific_sex[T.Male]  -0.434    0.157 -2.768 0.006 -0.741 -0.127
Group Var              1.169    0.127                           
================================================================
</code></pre>
</div>
</div>
<p>
The effects remain when the sex covariate is removed
</p>
<div id="model-e-no-covariates" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'unpleasant_1~trial_type'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
===============================================================
Model:               MixedLM  Dependent Variable:  unpleasant_1
No. Observations:    938      Method:              ML          
No. Groups:          340      Scale:               2.4893      
Min. group size:     2        Log-Likelihood:      -1902.7641  
Max. group size:     3        Converged:           Yes         
Mean group size:     2.8                                       
---------------------------------------------------------------
                      Coef. Std.Err.   z    P&gt;|z| [0.025 0.975]
---------------------------------------------------------------
Intercept             4.699    0.117 40.012 0.000  4.469  4.929
trial_type[T.disgust] 1.025    0.132  7.736 0.000  0.765  1.284
trial_type[T.fear]    0.207    0.132  1.563 0.118 -0.053  0.467
Group Var             1.212    0.130                           
===============================================================
</code></pre>
</div>
</div>
<br> <br>
<p>
<b>MODEL F: AROUSAL ~ TRIAL_TYPE</b>
</p>
<p>
In this case, the basic model with no by-participant random slope, no random intercepts and no additional covariates produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: fear videos were more arousing than points (<b>as predicted</b>)
</li><li>
But there was <b>no predicted difference</b> in arousal between points and disgust
<p>
</p>
<div id="model-f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'arousing_1~trial_type'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
================================================================
Model:                MixedLM   Dependent Variable:   arousing_1
No. Observations:     938       Method:               ML        
No. Groups:           340       Scale:                1.8470    
Min. group size:      2         Log-Likelihood:       -1780.8311
Max. group size:      3         Converged:            Yes       
Mean group size:      2.8                                       
----------------------------------------------------------------
                      Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
----------------------------------------------------------------
Intercept              4.835    0.104 46.511 0.000  4.631  5.039
trial_type[T.disgust] -0.053    0.114 -0.460 0.645 -0.277  0.171
trial_type[T.fear]     0.327    0.114  2.858 0.004  0.103  0.551
Group Var              1.077    0.125                           
================================================================
</code></pre>
</div>
</div>
<p>
<b>MODEL G: DISGUST ~ TRIAL_TYPE</b>
</p>
<p>
In this case, the basic model with no by-participant random slope, no random intercepts and age as a covariate produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: disgust videos were more disgusting than losing points (<b>as predicted</b>)
</li><li>
Fear videos, perhaps surprisingly, were significantly <b>less</b> disgusting than losing points
</li><li>
There was also a significant negative effect of age
<p>
</p>
<div id="model-g" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'disgusting_1~trial_type+prolific_age'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
================================================================
Model:              MixedLM   Dependent Variable:   disgusting_1
No. Observations:   938       Method:               ML          
No. Groups:         340       Scale:                2.4082      
Min. group size:    2         Log-Likelihood:       -1836.8158  
Max. group size:    3         Converged:            Yes         
Mean group size:    2.8                                         
----------------------------------------------------------------
                      Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
----------------------------------------------------------------
Intercept              2.235    0.230  9.697 0.000  1.783  2.686
trial_type[T.disgust]  4.494    0.130 34.644 0.000  4.240  4.748
trial_type[T.fear]    -0.685    0.130 -5.284 0.000 -0.940 -0.431
prolific_age          -0.012    0.004 -2.679 0.007 -0.021 -0.003
Group Var              0.645    0.092                           
================================================================
</code></pre>
</div>
</div>
<p>
The effects are unchanged when the age covariate is removed
</p>
<div id="model-g-no-covariate" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'disgusting_1~trial_type'</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
================================================================
Model:              MixedLM   Dependent Variable:   disgusting_1
No. Observations:   938       Method:               ML          
No. Groups:         340       Scale:                2.4094      
Min. group size:    2         Log-Likelihood:       -1840.3681  
Max. group size:    3         Converged:            Yes         
Mean group size:    2.8                                         
----------------------------------------------------------------
                      Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
----------------------------------------------------------------
Intercept              1.689    0.108 15.597 0.000  1.477  1.902
trial_type[T.disgust]  4.505    0.130 34.722 0.000  4.250  4.759
trial_type[T.fear]    -0.675    0.130 -5.200 0.000 -0.929 -0.420
Group Var              0.675    0.094                           
================================================================
</code></pre>
</div>
</div>
<p>
<b>MODEL H: FEAR ~ TRIAL_TYPE</b>
</p>
<p>
In this case, the basic model with no by-participant random slope, no random intercepts and age as a covariate produced the best fit (indexed by BIC scores).
</p>
</li><li>
This model found an effect of trial-type: fear videos were more frightening than losing points (<b>as predicted</b>)
</li><li>
Disgust videos, perhaps surprisingly (but mirroring results from model H), were significantly <b>less</b> frightening than losing points
</li><li>
There was also a significant negative effect of age
<p>
</p>
<div id="model-h" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'frightening_1~trial_type+prolific_age'</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
================================================================
Model:               MixedLM  Dependent Variable:  frightening_1
No. Observations:    938      Method:              ML           
No. Groups:          340      Scale:               2.6363       
Min. group size:     2        Log-Likelihood:      -1920.2160   
Max. group size:     3        Converged:           Yes          
Mean group size:     2.8                                        
----------------------------------------------------------------
                      Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
----------------------------------------------------------------
Intercept              2.656    0.268  9.916 0.000  2.131  3.181
trial_type[T.disgust] -0.398    0.136 -2.923 0.003 -0.665 -0.131
trial_type[T.fear]     3.869    0.136 28.398 0.000  3.602  4.136
prolific_age          -0.020    0.005 -3.800 0.000 -0.030 -0.010
Group Var              1.162    0.125                           
================================================================
</code></pre>
</div>
</div>
<p>
The effects are unchanged when the age covariate is removed
</p>
<div id="model-h-no-covariate" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> <span class="st">'frightening_1~trial_type'</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>smf.mixedlm(formula, data, groups<span class="op">=</span>data[<span class="st">'participant_no'</span>], missing<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit(reml<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Mixed Linear Model Regression Results
================================================================
Model:               MixedLM  Dependent Variable:  frightening_1
No. Observations:    938      Method:              ML           
No. Groups:          340      Scale:               2.6332       
Min. group size:     2        Log-Likelihood:      -1927.2695   
Max. group size:     3        Converged:           Yes          
Mean group size:     2.8                                        
----------------------------------------------------------------
                      Coef.  Std.Err.   z    P&gt;|z| [0.025 0.975]
----------------------------------------------------------------
Intercept              1.745    0.120 14.490 0.000  1.509  1.982
trial_type[T.disgust] -0.384    0.136 -2.817 0.005 -0.651 -0.117
trial_type[T.fear]     3.884    0.136 28.513 0.000  3.617  4.151
Group Var              1.258    0.131                           
================================================================
</code></pre>
</div>
</div>
<h3 class="anchored">
Conclusions
</h3>
<p>
Results from these models tells us:
</p>
</li><li>
The stimulus selection procedure was unable to produce perfectly matched fear and disgust videos (with disgust videos being marginally more negatively valenced and fear videos being more arousing).
</li><li>
There was a difference in habituation between fear and disgust (fear habituated less than disgust), which is in-line with previous literature.
</li><li>
Fear and disgust videos reliably induced the emotions of fear and disgust (with fear videos producing much higher fear ratings and vice versa).
</li><li>
The ‘loss’ feedback type (from the points conditions) was more similar to the emotional learning conditions than expected. It did not differ from fear in terms of valence and did not differ from disgust in terms of arousal.
</li><li>
The ‘loss’ feedback type was, however, very different to the emotional conditions in terms of fear and disgust ratings.
<p>
</p>

</li></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>