---
title: "Data visualisations"
format: gfm
fig-format: jpeg
---

```{python}
#| echo: false
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import scipy.stats as stats
import jsonlines
from functools import reduce
import statistics
import scipy.stats
import seaborn as sns
import math
import os
import json
import ast
import statsmodels.api as sm
import statsmodels.formula.api as smf
import pingouin as pg
import warnings
from scipy.stats import ttest_rel
#from statannotations.Annotator import Annotator
from scipy.stats import skew
from statsmodels.stats.diagnostic import het_white
from sklearn.preprocessing import PowerTransformer
import statannot
from scipy.stats import ttest_ind
import itertools
import matplotlib.patches as mpatches
plt.rcParams['figure.dpi'] = 300

warnings.simplefilter(action='ignore', category=FutureWarning)
pd.options.mode.copy_on_write = True
warnings.simplefilter(action='ignore', category=UserWarning)
FD_pvals=pd.read_csv("U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/results/video_ratings/pvals/videoRating_pvals_fearDisgust.csv")
expl_FD_pvals=pd.read_csv("U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/results/video_ratings/pvals/exploratory_videoRating_pvals_fearDisgust.csv")
#expl_points_pvals=pd.read_csv("U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/Full_results_markdown/exploratory_videoRating_pvals_points.csv")
points_pvals=pd.read_csv("U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/results/video_ratings/pvals/videoRating_pvals_points.csv")


task_summary=pd.read_csv("U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/csvs/dem_vids_task_excluded.csv")
chosen_stim_df=pd.read_csv('U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/csvs/chosen_stim_excluded.csv')
vid_ratings_df=pd.read_csv('U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/csvs/ratings_df.csv')
excluded_demographics=pd.read_csv('U:/Documents/Disgust learning project/github/disgust_reversal_learning-final/csvs/demographics_excluded.csv')

def pVal_annot(outcomeVar):
    fear_pVal=p_vals[p_vals.outcomeVar==outcomeVar].block_typeFear.iloc[0]
    if fear_pVal < 0.001:
        fear_annot='***'
    elif fear_pVal <0.01:
        fear_annot='**'
    elif fear_pVal <0.05:
        fear_annot='*'
    else:
        fear_annot='NonSig'

    points_pVal=p_vals[p_vals.outcomeVar==outcomeVar].block_typePoints.iloc[0]
    if points_pVal < 0.001:
        points_annot='***'
    elif points_pVal <0.01:
        points_annot='**'
    elif points_pVal <0.05:
        points_annot='*'
    else:
        points_annot='NonSig'
        
    pointsFear_pVal = p_vals[p_vals.outcomeVar==outcomeVar].pointsVsFear.iloc[0]
    if pointsFear_pVal < 0.001:
        pointsFear_annot='***'
    elif pointsFear_pVal <0.01:
        pointsFear_annot='**'
    elif pointsFear_pVal <0.05:
        pointsFear_annot='*'
    else:
        pointsFear_annot='NonSig'
        
    return fear_annot, points_annot, pointsFear_annot

def FD_pVal_annot(Condition):
    trial_type_pVal=FD_pvals[FD_pvals.Condition==Condition].trial_type.iloc[0]
    if trial_type_pVal < 0.001:
        trial_type_annot='***'
    elif trial_type_pVal <0.01:
        trial_type_annot='**'
    elif trial_type_pVal <0.05:
        trial_type_annot='*'
    else:
        trial_type_annot='NonSig'

    timepoint_pVal=FD_pvals[FD_pvals.Condition==Condition]['Timepoint'].iloc[0]
    if timepoint_pVal < 0.001:
        timepoint_annot='***'
    elif timepoint_pVal <0.01:
        timepoint_annot='**'
    elif timepoint_pVal <0.05:
        timepoint_annot='*'
    else:
        timepoint_annot='NonSig'

    interaction_pVal=FD_pvals[FD_pvals.Condition==Condition]['trial_type:Timepoint'].iloc[0]
    if interaction_pVal < 0.001:
        interaction_annot='***'
    elif interaction_pVal <0.01:
        interaction_annot='**'
    elif interaction_pVal <0.05:
        interaction_annot='*'
    else:
        interaction_annot='NonSig'
        
    return trial_type_annot, timepoint_annot, interaction_annot

def points_pVal_annot(Condition):
    fear_pVal=points_pvals[points_pvals.Condition==Condition]['trial_type[T.fear]'].iloc[0]
    if fear_pVal < 0.001:
        fear_annot='***'
    elif fear_pVal <0.01:
        fear_annot='**'
    elif fear_pVal <0.05:
        fear_annot='*'
    else:
        fear_annot='NonSig'

    disgust_pVal=points_pvals[points_pvals.Condition==Condition]['trial_type[T.disgust]'].iloc[0]
    if disgust_pVal < 0.001:
        disgust_annot='***'
    elif disgust_pVal <0.01:
        disgust_annot='**'
    elif disgust_pVal <0.05:
        disgust_annot='*'
    else:
        disgust_annot='NonSig'
        
    return fear_annot, disgust_annot

def expl_FD_pVal_annot(Condition):
    trial_type_pVal=expl_FD_pvals[expl_FD_pvals.Condition==Condition].trial_type.iloc[0]
    if trial_type_pVal < 0.001:
        trial_type_annot='***'
    elif trial_type_pVal <0.01:
        trial_type_annot='**'
    elif trial_type_pVal <0.05:
        trial_type_annot='*'
    else:
        trial_type_annot='NonSig'

    timepoint_pVal=expl_FD_pvals[expl_FD_pvals.Condition==Condition]['Timepoint'].iloc[0]
    if timepoint_pVal < 0.001:
        timepoint_annot='***'
    elif timepoint_pVal <0.01:
        timepoint_annot='**'
    elif timepoint_pVal <0.05:
        timepoint_annot='*'
    else:
        timepoint_annot='NonSig'

    interaction_pVal=expl_FD_pvals[expl_FD_pvals.Condition==Condition]['trial_type:Timepoint'].iloc[0]
    if interaction_pVal < 0.001:
        interaction_annot='***'
    elif interaction_pVal <0.01:
        interaction_annot='**'
    elif interaction_pVal <0.05:
        interaction_annot='*'
    else:
        interaction_annot='NonSig'
        
    return trial_type_annot, timepoint_annot, interaction_annot

```

<p>This file contains the code for the graphs included in the paper (and supplement)</p>



<h3>Video ratings task plots</h3>

```{python}
#| echo: false

#create long form df which allows for this
long_chosen_stim_df=pd.DataFrame()
for i in chosen_stim_df.index:
    row=chosen_stim_df.loc[i]
    #timepoint=['unpleasan']
    timepoint_1=pd.DataFrame({
    'participant_no': [row.participant_no],
    'age': [row.prolific_age],
    'sex': [row. prolific_sex],
    'Vid': [str(row['Vid'])],
    'trial_type': [row.trial_type],
    'Valence': [row.unpleasant_1],
    'Arousal': [row.arousing_1],
    'Fear': [row.frightening_1],
    'Disgust': [row.disgusting_1],
    'Timepoint': 1.0
    })
    timepoint_2=pd.DataFrame({
        'participant_no': [row.participant_no],
        'age': [row.prolific_age],
        'sex': [row. prolific_sex],
        'Vid': [str(row['Vid'])],
        'trial_type': [row.trial_type],
        'Valence': [row.unpleasant_2],
        'Arousal': [row.arousing_2],
        'Fear': [row.frightening_2],
        'Disgust': [row.disgusting_2],
        'Timepoint': 2.0
    })
    long_chosen_stim_df_row=pd.concat([timepoint_1, timepoint_2])
    long_chosen_stim_df=pd.concat([long_chosen_stim_df_row, long_chosen_stim_df])
    long_chosen_stim_df=long_chosen_stim_df[long_chosen_stim_df.trial_type!="points"]
```


<br>
<p>Firstly, compare fear and disgust videos across both timepoints</p>
```{python}
#| code-fold: true

fig, axes = plt.subplots(2,4, sharex='col', sharey='row',gridspec_kw={'height_ratios': [1.5, 1]})
fig.tight_layout(pad=0)
fig.set_size_inches(5.61, 3.7)

order=['disgust', 'fear']
dark_palette = {'disgust': "#5E2E9D" ,
                'fear': "#2487B8"}
palette = { 'disgust': "#3A0CA3",
            'fear': "#4CC9F0"}
            
trial_type_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Valence')

sns.boxplot(data=long_chosen_stim_df, ax=axes[0,0], x='Timepoint', y='Valence', hue='trial_type', hue_order=order, fill=False, palette=dark_palette, notch=True, linewidth=2)
sns.pointplot(data=long_chosen_stim_df, ax=axes[0,0], x='Timepoint', y='Valence', hue='trial_type', hue_order=order, palette=palette, marker='D', markersize=4, dodge=0.4, linestyle='none', ci=None, zorder=3)
axes[0,0].set_ylim(top=11.4)
axes[0,0].set_yticks(range(0, 11, 2)) 
axes[0,0].set_yticklabels(range(0, 11,2)) 
axes[0,0].set_title("Valence", fontsize=12) 
axes[0,0].set_ylabel('')

if trial_type_annot != 'NonSig': 
    x1, x2 = -0.2, 0.2  
    y, h, col = long_chosen_stim_df["Valence"].max() +0.5, 0.2, 'black'  
    axes[0,0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,0].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col) 
    x1, x2 = 0.8, 1.2  
    y, h, col = long_chosen_stim_df["Valence"].max() +0.5, 0.2, 'black'  
    axes[0,0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,0].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col)
if timepoint_annot != 'NonSig': 
    x1, x2 = 0, 1  
    y, h, col = long_chosen_stim_df["Valence"].max() +2, 0.5, 'black'  
    axes[0,0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,0].text((x1+x2)*.5, y+h, timepoint_annot, ha='center', va='bottom', color=col) 

sns.pointplot(data=long_chosen_stim_df, ax=axes[1,0], x='Timepoint', y='Valence', hue='trial_type', palette=palette, scale=0.75, marker='')
axes[1,0].xaxis.get_label().set_fontsize(12)
axes[1,0].yaxis.label.set_visible(False)
if interaction_annot != 'NonSig': 
    x= 0.5
    y= 4.65
    axes[1,0].text(x, y, interaction_annot, ha='center', va='bottom', color='black', fontsize=12)


###AROUSAL
trial_type_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Arousal')

sns.boxplot(data=long_chosen_stim_df, ax=axes[0,1], x='Timepoint', y='Arousal', hue='trial_type', hue_order=order, fill=False, palette=dark_palette, notch=True, linewidth=2)
sns.pointplot(data=long_chosen_stim_df, ax=axes[0,1], x='Timepoint', y='Arousal', hue='trial_type', hue_order=order, palette=palette, marker='D', markersize=4, dodge=0.4, linestyle='none', ci=None, zorder=3)
axes[0,1].set_title("Arousal", fontsize=12) 
if trial_type_annot != 'NonSig': 
    x1, x2 = -0.2, 0.2  
    y, h, col = long_chosen_stim_df["Valence"].max() +0.5, 0.2, 'black'  
    axes[0,1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,1].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col) 
    x1, x2 = 0.8, 1.2  
    y, h, col = long_chosen_stim_df["Valence"].max() +0.5, 0.2, 'black'  
    axes[0,1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,1].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col)
if timepoint_annot != 'NonSig': 
    x1, x2 = 0, 1  
    y, h, col = long_chosen_stim_df["Valence"].max() +2, 0.5, 'black'  
    axes[0,1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,1].text((x1+x2)*.5, y+h, timepoint_annot, ha='center', va='bottom', color=col) 


sns.pointplot(data=long_chosen_stim_df, ax=axes[1,1], x='Timepoint',y='Arousal', hue='trial_type', palette=palette, marker='', scale=0.75)
axes[1,1].xaxis.get_label().set_fontsize(12)
sns.pointplot(data=long_chosen_stim_df, ax=axes[1,0], x='Timepoint', y='Valence', hue='trial_type', palette=palette, scale=0.75, marker='')
axes[1,1].xaxis.get_label().set_fontsize(12)
axes[1,1].set_ylabel('')
if interaction_annot != 'NonSig': 
    x= 0.5
    y= 4.75
    axes[1,1].text(x, y, interaction_annot, ha='center', va='bottom', color='black', fontsize=12)

trial_type_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Fear')
sns.boxplot(data=long_chosen_stim_df, ax=axes[0,2], x='Timepoint', y='Fear', hue='trial_type', hue_order=order, fill=False, palette=dark_palette, notch=True, linewidth=2)
sns.pointplot(data=long_chosen_stim_df, ax=axes[0,2], x='Timepoint', y='Fear', hue='trial_type', hue_order=order, palette=palette, marker='D', markersize=5, dodge=0.4, linestyle='none', ci=None, zorder=3)
axes[0,2].set_title("Fear", fontsize=12) 
axes[0,2].set_ylabel('')

if trial_type_annot != 'NonSig': 
    x1, x2 = -0.2, 0.2  
    y, h, col = long_chosen_stim_df["Fear"].max() +0.5, 0.2, 'black'  
    axes[0,2].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,2].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col) 
    x1, x2 = 0.8, 1.2  
    y, h, col = long_chosen_stim_df["Fear"].max() +0.5, 0.2, 'black'  
    axes[0,2].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,2].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col)
if timepoint_annot != 'NonSig': 
    x1, x2 = 0, 1  
    y, h, col = long_chosen_stim_df["Fear"].max() +2, 0.5, 'black'  
    axes[0,2].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,2].text((x1+x2)*.5, y+h, timepoint_annot, ha='center', va='bottom', color=col) 



sns.pointplot(data=long_chosen_stim_df, ax=axes[1,2], x='Timepoint', y='Fear', hue='trial_type', scale=0.75, palette=palette, markersize=5, marker='')
axes[1,2].xaxis.get_label().set_fontsize(12)
axes[1,2].set_ylabel('')
if interaction_annot != 'NonSig': 
    x= 0.5
    y= 3.5
    axes[1,2].text(x, y, interaction_annot, ha='center', va='bottom', color='black', fontsize=12)

###DISGUST
trial_type_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Disgust')

sns.boxplot(data=long_chosen_stim_df, ax=axes[0,3], x='Timepoint', y='Disgust', hue='trial_type', hue_order=order, fill=False, palette=dark_palette, notch=True, linewidth=2)
sns.pointplot(data=long_chosen_stim_df, ax=axes[0,3], x='Timepoint', y='Disgust', hue='trial_type', hue_order=order, palette=palette, marker='D', markersize=5, dodge=0.4, linestyle='none', ci=None)
axes[0,3].set_title("Disgust", fontsize=12) 
if trial_type_annot != 'NonSig': 
    x1, x2 = -0.2, 0.2  
    y, h, col = long_chosen_stim_df["Disgust"].max() +0.5, 0.2, 'black'  
    axes[0,3].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,3].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col) 
    x1, x2 = 0.8, 1.2  
    y, h, col = long_chosen_stim_df["Disgust"].max() +0.5, 0.2, 'black'  
    axes[0,3].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,3].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col)
if timepoint_annot != 'NonSig': 
    x1, x2 = 0, 1  
    y, h, col = long_chosen_stim_df["Disgust"].max() +2, 0.5, 'black'  
    axes[0,3].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0,3].text((x1+x2)*.5, y+h, timepoint_annot, ha='center', va='bottom', color=col) 


sns.pointplot(data=long_chosen_stim_df, ax=axes[1,3], x='Timepoint', y='Disgust', hue='trial_type', scale=0.75, palette=palette, marker='')
axes[1,3].xaxis.get_label().set_fontsize(12)
if interaction_annot != 'NonSig': 
    x= 0.5
    y= 3.5
    axes[1,3].text(x, y, interaction_annot, ha='center', va='bottom', color='black', fontsize=12)

#plt.figlegend(loc='center left', bbox_to_anchor=(1,0.5),  handles=[mpatches.Patch(facecolor="#5E2E9D"), mpatches.Patch(facecolor="#2487B8")], labels=['Disgust video', 'Fear video'], prop={'size':10})

for ax in axes.flatten():
    ax.get_legend().set_visible(False)
plt.savefig('VidRating_FearDisgust.jpeg', dpi=300, bbox_inches='tight')
```



<p>Next, compare fear and disgust ratings (at T1) to points ratings (only taken once)</p>

```{python}
#| code-fold: true
data=chosen_stim_df[['participant_no', 'trial_type', 'unpleasant_1', 'arousing_1', 'disgusting_1', 'frightening_1']].sort_values('trial_type')
fig, axes = plt.subplots(1,4, sharey='row')
title="Initial ratings of videos fear, disgust and points videos"
#plt.suptitle(title, fontsize=16)
fig.tight_layout(pad=1)
#fig.set_size_inches(8.3, 5.8)
fig.set_size_inches(5.61, 2.5)

order=['points', 'disgust', 'fear']
palette = ["#F72585", "#3A0CA3", "#4CC9F0"]
dark_palette = ["#9B0F47", "#5E2E9D", "#2487B8"]

sns.boxplot(data=data, ax=axes[0],   x='trial_type', hue='trial_type', y='unpleasant_1', legend=False, fill=False, order=order, palette=dark_palette, hue_order=order, notch=True)
sns.pointplot(data=data, ax=axes[0],   x='trial_type', hue='trial_type', y='unpleasant_1', legend=False, order=order, palette=palette, hue_order=order, errorbar=None, marker='D', markersize=3.5)

fear_annot, disgust_annot=points_pVal_annot('Valence')
if fear_annot != 'NonSig':
    x1, x2 = 0, 2  
    y, h, col =long_chosen_stim_df["Disgust"].max() +2, 0.5, 'black'    
    axes[0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0].text((x1+x2)*.5, y+h, fear_annot, ha='center', va='bottom', color=col)  
if disgust_annot != 'NonSig':
    x1, x2 = 0, 0.9  
    y, h, col = 8.5, 0.25, 'black'  
    axes[0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0].text((x1+x2)*.5, y+h, disgust_annot, ha='center', va='bottom', color=col) 

axes[0].set_xlabel('')
axes[0].set_ylabel('')
axes[0].set_title('Valence', fontsize=12)
axes[0].set_xticklabels(['Points', 'Disgust', 'Fear'], rotation=45)
axes[0].set_ylim(top=11.4)
axes[0].set_yticks(range(0, 11,2)) 
axes[0].set_yticklabels(range(0, 11,2))

##AROUSAL
sns.boxplot(data=data, ax=axes[1], x='trial_type', hue='trial_type', y='arousing_1', palette=dark_palette, legend=False, fill=False, order=order, hue_order=order, notch=True)
sns.pointplot(data=data, ax=axes[1], x='trial_type', hue='trial_type', y='arousing_1', palette=palette, legend=False, order=order, hue_order=order, errorbar=None, marker='D', markersize=3.5)
fear_annot, disgust_annot=points_pVal_annot('Arousal')
if fear_annot != 'NonSig':
    x1, x2 = 0, 2  
    y, h, col = long_chosen_stim_df["Disgust"].max() +2, 0.5, 'black'   
    axes[1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[1].text((x1+x2)*.5, y+h, fear_annot, ha='center', va='bottom', color=col)  
if disgust_annot != 'NonSig':
    x1, x2 = 0, 1  
    y, h, col = 8.5, 0.25, 'black'  
    axes[1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[1].text((x1+x2)*.5, y+h, disgust_annot, ha='center', va='bottom', color=col) 

axes[1].set_xlabel('')
axes[1].set_ylabel('')
axes[1].set_title('Arousal', fontsize=12)
axes[1].set_xticklabels(['Points', 'Disgust', 'Fear'], rotation=45)


##DISGUST
sns.boxplot(data=data, ax=axes[2], x='trial_type', hue='trial_type', y='disgusting_1', palette=dark_palette, legend=False, fill=False, order=order, hue_order=order, notch=True)
sns.pointplot(data=data, ax=axes[2], x='trial_type', hue='trial_type', y='disgusting_1', palette=palette, legend=False, order=order, hue_order=order, errorbar=None, marker='D', markersize=3.5)

fear_annot, disgust_annot=points_pVal_annot('Disgust')
if fear_annot != 'NonSig':
    x1, x2 = 0, 2  
    y, h, col = long_chosen_stim_df["Disgust"].max() +2, 0.5, 'black'  
    axes[2].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[2].text((x1+x2)*.5, y+h, fear_annot, ha='center', va='bottom', color=col)  
if disgust_annot != 'NonSig':
    x1, x2 = 0, 0.9  
    y, h, col = 8.5, 0.25, 'black'  
    axes[2].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[2].text((x1+x2)*.5, y+h, disgust_annot, ha='center', va='bottom', color=col) 

axes[2].set_xlabel('')
axes[2].set_ylabel('')
axes[2].set_title('Disgust', fontsize=12)
axes[2].set_xticklabels(['Points', 'Disgust', 'Fear'], rotation=45)
axes[2].set_ylim(top=11.4)
axes[2].set_yticks(range(0, 11,2)) 
axes[2].set_yticklabels(range(0, 11,2))


##FEAR
sns.boxplot(data=data, ax=axes[3], x='trial_type',  hue='trial_type', y='frightening_1', palette=dark_palette, legend=False, fill=False, order=order, hue_order=order, notch=True)
sns.pointplot(data=data, ax=axes[3], x='trial_type', hue='trial_type', y='frightening_1', palette=palette, legend=False, order=order, hue_order=order, errorbar=None, marker='D', markersize=3.5)

fear_annot, disgust_annot=points_pVal_annot('Fear')
if fear_annot != 'NonSig':
    x1, x2 = 0, 2  
    y, h, col = long_chosen_stim_df["Disgust"].max() +2, 0.5, 'black'   
    axes[3].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[3].text((x1+x2)*.5, y+h, fear_annot, ha='center', va='bottom', color=col)  
if disgust_annot != 'NonSig':
    x1, x2 = 0, 0.9  
    y, h, col = 8.5, 0.25, 'black'  
    axes[3].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[3].text((x1+x2)*.5, y+h, disgust_annot, ha='center', va='bottom', color=col) 
axes[3].set_xticklabels(['Points', 'Disgust', 'Fear'], rotation=45)
axes[3].set_xlabel('')
axes[3].set_ylabel('')
axes[3].set_title('Fear', fontsize=12)

##add that fear and disgust were different by all metrics (shown by models A-D)
x1, x2 = 1.1, 2  
y, h, col = 8.5, 0.25, 'black'  

valence_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Valence')
arousal_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Arousal')
fear_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Fear')
disgust_annot, timepoint_annot, interaction_annot = FD_pVal_annot('Disgust')

axes[0].text((x1+x2)*.5, y+h, valence_annot, ha='center', va='bottom', color=col)
axes[0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col) 
axes[1].text((x1+x2)*.5, y+h, arousal_annot, ha='center', va='bottom', color=col)
axes[1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col) 
axes[2].text((x1+x2)*.5, y+h, fear_annot, ha='center', va='bottom', color=col)
axes[2].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col) 
axes[3].text((x1+x2)*.5, y+h, disgust_annot, ha='center', va='bottom', color=col)
axes[3].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col) 

#plt.figlegend(loc='center left', bbox_to_anchor=(1,0.5),  handles=[mpatches.Patch(facecolor="#9B0F47"), mpatches.Patch(facecolor="#5E2E9D"), mpatches.Patch(facecolor="#2487B8")], labels=['Losing points', 'Disgust video', 'Fear video'], prop={'size':10})

plt.savefig('VidRating_Points.jpeg', dpi=300, bbox_inches='tight')
```


<p>The plots above show just the ratings for the 'chosen stimuli' (those used in the reversal learning task). We can see how this differs to when you look across all emotional videos (5 fear videos and 5 disgust videos)</p>
```{python}
#| code-fold: true

##create long video rating data-frame to allow this
long_vid_ratings=pd.DataFrame()
for i in vid_ratings_df.index:
    row=vid_ratings_df.loc[i]
    timepoint_1=pd.DataFrame({
    'participant_no': [row.participant_no],
    #'age': [row.prolific_age],
    #'sex': [row. prolific_sex],
    'Vid': [str(row['Vid'])],
    'trial_type': [row.trial_type],
    'Valence': [row.unpleasant_1],
    'Arousal': [row.arousing_1],
    'Fear': [row.frightening_1],
    'Disgust': [row.disgusting_1],
    'Timepoint': 1.0
    })
    timepoint_2=pd.DataFrame({
        'participant_no': [row.participant_no],
        #'age': [row.prolific_age],
        #'sex': [row. prolific_sex],
        'Vid': [str(row['Vid'])],
        'trial_type': [row.trial_type],
        'Valence': [row.unpleasant_2],
        'Arousal': [row.arousing_2],
        'Fear': [row.frightening_2],
        'Disgust': [row.disgusting_2],
        'Timepoint': 2.0
    })
    long_vid_ratings_row=pd.concat([timepoint_1, timepoint_2])
    long_vid_ratings=pd.concat([long_vid_ratings_row, long_vid_ratings])
    long_vid_ratings=long_vid_ratings[long_vid_ratings.trial_type!="points"]

fig, axes = plt.subplots(2,1, sharex='col', sharey='row')
fig.tight_layout(pad=1)
fig.set_size_inches(1.4, 5)

order=['disgust', 'fear']
dark_palette = {'disgust': "#3e236e" ,
                'fear': "#2487B8"}
palette = { 'disgust': "#673ab7",
            'fear': "#4CC9F0"}

###VALENCE
fig.text(0.25, 1.05, 'All videos', va='center', ha='center', fontsize=14, weight='bold')         

sns.boxplot(data=long_vid_ratings, ax=axes[0], x='Timepoint', y='Valence', hue='trial_type', hue_order=order, fill=True, saturation=0.5, palette=dark_palette, notch=True, linewidth=2)
sns.pointplot(data=long_vid_ratings, ax=axes[0], x='Timepoint', y='Valence', hue='trial_type', hue_order=order, color='black', marker='D', markersize=4, dodge=0.4, linestyle='none', ci=None, zorder=3)
axes[0].set_ylim(top=11.4)
axes[0].set_yticks(range(0, 11, 2)) 
axes[0].set_yticklabels(range(0, 11,2)) 
axes[0].set_title("Valence", fontsize=12) 
axes[0].set_ylabel('')
axes[0].margins(x=0.15)

trial_type_annot, timepoint_annot, interaction_annot = expl_FD_pVal_annot('Valence')
if trial_type_annot != 'NonSig': 
    x1, x2 = -0.2, 0.2  
    y, h, col = long_vid_ratings["Valence"].max() +0.5, 0.2, 'black'  
    axes[0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col) 
    x1, x2 = 0.8, 1.2  
    y, h, col = long_vid_ratings["Valence"].max() +0.5, 0.2, 'black'  
    axes[0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col)
if timepoint_annot != 'NonSig': 
    x1, x2 = 0, 1  
    y, h, col = long_vid_ratings["Valence"].max() +2, 0.5, 'black'  
    axes[0].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[0].text((x1+x2)*.5, y+h, timepoint_annot, ha='center', va='bottom', color=col) 

sns.boxplot(data=long_vid_ratings, ax=axes[1], x='Timepoint', y='Arousal', hue='trial_type', hue_order=order, fill=True, saturation=0.5, palette=dark_palette, notch=True, linewidth=2)
sns.pointplot(data=long_vid_ratings, ax=axes[1], x='Timepoint', y='Arousal', hue='trial_type', hue_order=order, color='black', marker='D', markersize=4, dodge=0.4, linestyle='none', ci=None, zorder=3)
axes[1].set_ylim(top=11.4)
axes[1].set_yticks(range(0, 11, 2)) 
axes[1].set_yticklabels(range(0, 11,2)) 
axes[1].set_title("Arousal", fontsize=12) 
axes[1].set_ylabel('')
axes[1].margins(x=0.15)

trial_type_annot, timepoint_annot, interaction_annot = expl_FD_pVal_annot('Arousal')
if trial_type_annot != 'NonSig': 
    x1, x2 = -0.2, 0.2  
    y, h, col = long_vid_ratings["Arousal"].max() +0.5, 0.2, 'black'  
    axes[1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[1].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col) 
    x1, x2 = 0.8, 1.2  
    y, h, col = long_vid_ratings["Arousal"].max() +0.5, 0.2, 'black'  
    axes[1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[1].text((x1+x2)*.5, y+h, trial_type_annot, ha='center', va='bottom', color=col)
if timepoint_annot != 'NonSig': 
    x1, x2 = 0, 1  
    y, h, col = long_vid_ratings["Arousal"].max() +2, 0.5, 'black'  
    axes[1].plot([x1, x1, x2, x2], [y, y+h, y+h, y], lw=1.5, c=col)  
    axes[1].text((x1+x2)*.5, y+h, timepoint_annot, ha='center', va='bottom', color=col) 

for ax in axes.flatten():
    ax.get_legend().set_visible(False)

plt.savefig('Exploratory_VidRating_allVids.jpeg', dpi=300, bbox_inches='tight')
```

